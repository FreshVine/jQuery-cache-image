!function(e){e.fn.cacheImages=function(a){this.cacheImagesConfig=e.extend({},e.fn.cacheImages.defaults,a),this.cacheImagesConfig.encodeOnCanvas=void 0!=typeof HTMLCanvasElement?this.cacheImagesConfig.encodeOnCanvas:!1,void 0==typeof this.cacheImagesConfig.forceSave&&(this.cacheImagesConfig.forceSave=!1);var c=this;return/^data:image/.test(this.cacheImagesConfig.defaultImage)===!1&&(this.cacheImagesConfig.defaultSrc=this.cacheImagesConfig.defaultImage),this.each(function(a,A){e.fn.cacheImages.storageAvailable(e(A),a,A,function(a,A){var n,t=e(A);if("IMG"===t.prop("tagName")){t.data("cachedImageType","src");var n=t.prop("src")||t.data("cachedImageSrc");null!==c.cacheImagesConfig.url&&(n=c.cacheImagesConfig.url,t.prop("src",""))}else{t.data("cachedImageType","css");var n=t.css("background-image").replace(/"/g,"").replace(/url\(|\)$/gi,"")||t.data("cachedImageSrc");null!==c.cacheImagesConfig.url&&(n=c.cacheImagesConfig.url,t.css("background-image","url()"))}if("undefined"==typeof n)return!0;if("undefined"!=typeof t.prop("src")&&"data:"===t.prop("src").substring(0,5))return!0;var s=c.cacheImagesConfig.storagePrefix+":"+n;e.fn.cacheImages.get(t,s,function(a,s){if(c.cacheImagesConfig.forceSave,s&&/^data:image/.test(s)&&0==c.cacheImagesConfig.forceSave)return this.data("cachedImageSrc",n),"src"==this.data("cachedImageType")?this.prop("src",s):this.css("background-image","url("+s+")"),c.cacheImagesConfig.done.call(this,s),void c.cacheImagesConfig.always.call(this);if("pending"===s)return c.cacheImagesConfig.fail.call(this),void c.cacheImagesConfig.always.call(this);"src"==this.data("cachedImageType")?this.prop("src",""):this.css("background-image","url()");var o=n.match(/\.(jpg|jpeg|png|gif)$/i);if(o&&o.length&&(o="jpg"==o[1].toLowerCase()?"jpeg":o[1].toLowerCase()),"undefined"==typeof o)return c.cacheImagesConfig.fail.call(this),void c.cacheImagesConfig.always.call(this);if(this.data("cachedImageSrc",n),e.fn.cacheImages.set(this,a,"pending",function(){}),c.cacheImagesConfig.encodeOnCanvas&&"gif"!==o)t.load(function(){newSrc=e.fn.cacheImages.base64EncodeCanvas(A),e.fn.cacheImages.set(this,a,newSrc),"data:"===n.substring(0,5)&&("src"==this.data("cachedImageType")?this.prop("src",newSrc):this.css("background-image","url("+newSrc+")"),this.is(".cacheImagesRemove")&&this.remove())});else{var g=new XMLHttpRequest,i=this;g.open("GET",n,!0),g.responseType="arraybuffer",g.onload=function(){newSrc="",200==this.status&&(newSrc="data:image/"+o+";base64,"+e.fn.cacheImages.base64EncodeResponse(this.response)),e.fn.cacheImages.set(i,a,newSrc,function(a,A){return 0!==A.length&&A!=="data:image/"+o+";base64,"?("src"==this.data("cachedImageType")?this.prop("src",A):this.css("background-image","url("+A+")"),this.is(".cacheImagesRemove")&&this.remove(),c.cacheImagesConfig.done.call(this,!1),void c.cacheImagesConfig.always.call(this)):void e.fn.cacheImages.set(this,a,"error",function(){return"undefined"!=typeof c.cacheImagesConfig.defaultSrc?(c.cacheImagesConfig.url=c.cacheImagesConfig.defaultImage,void this.cacheImages(c.cacheImagesConfig)):("src"==this.data("cachedImageType")?this.prop("src",c.cacheImagesConfig.defaultImage):this.css("background-image","url("+c.cacheImagesConfig.defaultImage+")"),c.cacheImagesConfig.fail.call(this),c.cacheImagesConfig.always.call(this),void 0)})})},g.send()}})})})},e.fn.cacheImages.defaults={always:function(){},debug:!1,defaultImage:"data:image/png;base64,/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja3kAAQAEAAAAHgAA/+4ADkFkb2JlAGTAAAAAAf/bAIQAEAsLCwwLEAwMEBcPDQ8XGxQQEBQbHxcXFxcXHx4XGhoaGhceHiMlJyUjHi8vMzMvL0BAQEBAQEBAQEBAQEBAQAERDw8RExEVEhIVFBEUERQaFBYWFBomGhocGhomMCMeHh4eIzArLicnJy4rNTUwMDU1QEA/QEBAQEBAQEBAQEBA/8AAEQgAZABkAwEiAAIRAQMRAf/EAEsAAQEAAAAAAAAAAAAAAAAAAAAFAQEAAAAAAAAAAAAAAAAAAAAAEAEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//2Q==",done:function(){},encodeOnCanvas:!1,fail:function(){},ready:!0,storagePrefix:"cached",url:null},e.fn.cacheImages.storageAvailable=function(a,c,A,n){return"object"==typeof localStorage?void n.call(a,c,A):void(e.fn.cacheImages.defaults.debug&&console.log("localStorage not available"))},e.fn.cacheImages.set=function(e,a,c,A){localStorage[a]=c,"function"==typeof A&&A.call(e,a,c)},e.fn.cacheImages.get=function(e,a,c){var A=null;"undefined"!=typeof localStorage[a]&&(A=localStorage[a]),"function"==typeof c&&c.call(e,a,A)},e.fn.cacheImages.base64EncodeCanvas=function(e){try{var a=document.createElement("canvas");a.width=e.width,a.height=e.height;var c=a.getContext("2d");c.drawImage(e,0,0);var A=e.src.match(/\.(jpg|jpeg|png)$/i);if(!A||!A.length)throw"Invalid image type for canvas encoder: "+e.src;return A="jpg"==A[1].toLowerCase()?"jpeg":A[1].toLowerCase(),a.toDataURL("image/"+A)}catch(n){return console&&console.log(n),"error"}},e.fn.cacheImages.base64EncodeResponse=function(e){for(var a,c,A,n,t,s="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=new Uint8Array(e),i=g.byteLength,r=i%3,l=i-r,f=0;l>f;f+=3)t=g[f]<<16|g[f+1]<<8|g[f+2],a=(16515072&t)>>18,c=(258048&t)>>12,A=(4032&t)>>6,n=63&t,s+=o[a]+o[c]+o[A]+o[n];return 1===r?(t=g[l],a=(252&t)>>2,c=(3&t)<<4,s+=o[a]+o[c]+"=="):2===r&&(t=g[l]<<8|g[l+1],a=(16128&t)>>8,c=(1008&t)>>4,A=(15&t)<<2,s+=o[a]+o[c]+o[A]+"="),s},e.fn.cacheImages.fetchURL=function(a){e("body").append(e('<img style="display: none;" />').addClass("cacheImagesRemove").cacheImages({url:a}))},e.fn.cacheImages.Output=function(a,c,A){"undefined"==typeof A&&(A=e.fn.cacheImages.defaults.storagePrefix);var n=A+":"+a;return null!=window.localStorage.getItem(n)?window.localStorage.getItem(n):/^data:image/.test(this.cacheImagesConfig.defaultImage)===!0?this.cacheImagesConfig.defaultImage:(n=A+":"+this.cacheImagesConfig.defaultImage,null!=window.localStorage.getItem(n)?("function"==typeof c&&c.call(thisElem,n),window.localStorage.getItem(n)):null)},e.fn.cacheImages.drop=function(a,c,A){var n=[];for("undefined"==typeof A&&(A=e.fn.cacheImages.defaults.storagePrefix),"undefined"==typeof a&&(a=null),i=0;i<window.localStorage.length;i++)window.localStorage.key(i).substr(0,A.length+1)===A+":"&&(null===a||window.localStorage.key(i)===A+":"+a)&&n.push(window.localStorage.key(i));if(0===n.length)e.fn.cacheImages.defaults.debug&&console.log("No Images to Drop");else{for(i=0;i<n.length;i++)e.fn.cacheImages.defaults.debug&&console.log("Dropping localStorage Key:",n[i]),window.localStorage.removeItem(n[i]);e.fn.cacheImages.defaults.debug&&console.log("Dropped "+n.length+" images from storage")}"function"==typeof c&&c.call(thisElem,a)}}(jQuery);