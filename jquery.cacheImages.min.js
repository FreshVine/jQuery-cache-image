!function(a){a.fn.cacheImages=function(b){this.cacheImagesConfig=a.extend({},a.fn.cacheImages.defaults,b),this.cacheImagesConfig.encodeOnCanvas=void 0!=typeof HTMLCanvasElement&&this.cacheImagesConfig.encodeOnCanvas;var c=this;return"function"==typeof this.cacheImagesConfig.start&&c.cacheImagesConfig.start(this),/^data:image/.test(this.cacheImagesConfig.defaultImage)===!1&&(this.cacheImagesConfig.defaultSrc=this.cacheImagesConfig.defaultImage),this.each(function(b,d){a.fn.cacheImages.storageAvailable(a(d),b,d,function(b,d){var f,e=a(d);if("IMG"===e.prop("tagName")){e.data("cachedImageType","src");var f=e.prop("src")||e.data("cachedImageSrc");null!==c.cacheImagesConfig.url&&(f=c.cacheImagesConfig.url,e.prop("src",""))}else{e.data("cachedImageType","css");var f=e.css("background-image").replace(/"/g,"").replace(/url\(|\)$/gi,"")||e.data("cachedImageSrc");null!==c.cacheImagesConfig.url&&(f=c.cacheImagesConfig.url,e.css("background-image","url()"))}if("undefined"==typeof f)return c.cacheImagesConfig.fail.call(this),c.cacheImagesConfig.always.call(this),!0;if("undefined"!=typeof e.prop("src")&&"data:"===e.prop("src").substring(0,5))return c.cacheImagesConfig.done.call(this),c.cacheImagesConfig.always.call(this),!0;var g=c.cacheImagesConfig.storagePrefix+":"+f;a.fn.cacheImages.get(e,g,function(b,g){if(g&&/^data:image/.test(g))return this.data("cachedImageSrc",f),"src"==this.data("cachedImageType")?this.prop("src",g):this.css("background-image","url("+g+")"),c.cacheImagesConfig.done.call(this,g),void c.cacheImagesConfig.always.call(this);if("pending"===g)return c.cacheImagesConfig.fail.call(this),void c.cacheImagesConfig.always.call(this);"src"==this.data("cachedImageType")?this.prop("src",""):this.css("background-image","url()");var h=f.match(/\.(jpg|jpeg|png|gif)$/i);if(h&&h.length&&(h="jpg"==h[1].toLowerCase()?"jpeg":h[1].toLowerCase()),"undefined"==typeof h)return c.cacheImagesConfig.fail.call(this),void c.cacheImagesConfig.always.call(this);if(this.data("cachedImageSrc",f),a.fn.cacheImages.set(this,b,"pending",function(a,b){}),c.cacheImagesConfig.encodeOnCanvas&&"gif"!==h)e.load(function(){newSrc=a.fn.cacheImages.base64EncodeCanvas(d),a.fn.cacheImages.set(this,b,newSrc),"data:"===f.substring(0,5)&&("src"==this.data("cachedImageType")?this.prop("src",newSrc):this.css("background-image","url("+newSrc+")"),this.is(".cacheImagesRemove")&&this.remove())});else{var i=new XMLHttpRequest,j=this;i.open("GET",f,!0),i.responseType="arraybuffer",i.onload=function(d){newSrc="",200==this.status&&(newSrc="data:image/"+h+";base64,"+a.fn.cacheImages.base64EncodeResponse(this.response)),a.fn.cacheImages.set(j,b,newSrc,function(b,d){return 0!==d.length&&d!=="data:image/"+h+";base64,"?("src"==this.data("cachedImageType")?this.prop("src",d):this.css("background-image","url("+d+")"),this.is(".cacheImagesRemove")&&this.remove(),c.cacheImagesConfig.done.call(this,!1),void c.cacheImagesConfig.always.call(this)):void a.fn.cacheImages.set(this,b,"error",function(a,b){return"undefined"!=typeof c.cacheImagesConfig.defaultSrc?(c.cacheImagesConfig.url=c.cacheImagesConfig.defaultImage,this.cacheImages(c.cacheImagesConfig),c.cacheImagesConfig.fail.call(this),void c.cacheImagesConfig.always.call(this)):("src"==this.data("cachedImageType")?this.prop("src",c.cacheImagesConfig.defaultImage):this.css("background-image","url("+c.cacheImagesConfig.defaultImage+")"),c.cacheImagesConfig.fail.call(this),c.cacheImagesConfig.always.call(this),void 0)})})},i.send()}})})})},a.fn.cacheImages.defaults={always:function(){},debug:!1,defaultImage:"data:image/png;base64,/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja3kAAQAEAAAAHgAA/+4ADkFkb2JlAGTAAAAAAf/bAIQAEAsLCwwLEAwMEBcPDQ8XGxQQEBQbHxcXFxcXHx4XGhoaGhceHiMlJyUjHi8vMzMvL0BAQEBAQEBAQEBAQEBAQAERDw8RExEVEhIVFBEUERQaFBYWFBomGhocGhomMCMeHh4eIzArLicnJy4rNTUwMDU1QEA/QEBAQEBAQEBAQEBA/8AAEQgAZABkAwEiAAIRAQMRAf/EAEsAAQEAAAAAAAAAAAAAAAAAAAAFAQEAAAAAAAAAAAAAAAAAAAAAEAEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//2Q==",done:function(a){},encodeOnCanvas:!1,fail:function(){},ready:!0,start:function(){},storagePrefix:"cached",url:null},a.fn.cacheImages.storageAvailable=function(b,c,d,e){return"object"==typeof localStorage?void e.call(b,c,d):void(a.fn.cacheImages.defaults.debug&&console.log("localStorage not available"))},a.fn.cacheImages.set=function(a,b,c,d){localStorage[b]=c,"function"==typeof d&&d.call(a,b,c)},a.fn.cacheImages.get=function(a,b,c){var d=null;"undefined"!=typeof localStorage[b]&&(d=localStorage[b]),"function"==typeof c&&c.call(a,b,d)},a.fn.cacheImages.base64EncodeCanvas=function(a){try{var b=document.createElement("canvas");b.width=a.width,b.height=a.height;var c=b.getContext("2d");c.drawImage(a,0,0);var d=a.src.match(/\.(jpg|jpeg|png)$/i);if(!d||!d.length)throw"Invalid image type for canvas encoder: "+a.src;return d="jpg"==d[1].toLowerCase()?"jpeg":d[1].toLowerCase(),b.toDataURL("image/"+d)}catch(a){return console&&console.log(a),"error"}},a.fn.cacheImages.base64EncodeResponse=function(a){for(var h,i,j,k,l,b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=new Uint8Array(a),e=d.byteLength,f=e%3,g=e-f,m=0;m<g;m+=3)l=d[m]<<16|d[m+1]<<8|d[m+2],h=(16515072&l)>>18,i=(258048&l)>>12,j=(4032&l)>>6,k=63&l,b+=c[h]+c[i]+c[j]+c[k];return 1===f?(l=d[g],h=(252&l)>>2,i=(3&l)<<4,b+=c[h]+c[i]+"=="):2===f&&(l=d[g]<<8|d[g+1],h=(16128&l)>>8,i=(1008&l)>>4,j=(15&l)<<2,b+=c[h]+c[i]+c[j]+"="),b},a.fn.cacheImages.fetchURL=function(b,c){a("body").append(a('<img style="display: none;" />').addClass("cacheImagesRemove").cacheImages({url:b}))},a.fn.cacheImages.Output=function(b,c,d){"undefined"==typeof d&&(d=a.fn.cacheImages.defaults.storagePrefix);var e=d+":"+b;return null!=window.localStorage.getItem(e)?window.localStorage.getItem(e):/^data:image/.test(this.cacheImagesConfig.defaultImage)===!0?this.cacheImagesConfig.defaultImage:(e=d+":"+this.cacheImagesConfig.defaultImage,null!=window.localStorage.getItem(e)?window.localStorage.getItem(e):null)},a.fn.cacheImages.drop=function(b,c){var d=[];for("undefined"==typeof c&&(c=a.fn.cacheImages.defaults.storagePrefix),"undefined"==typeof b&&(b=null),i=0;i<window.localStorage.length;i++)window.localStorage.key(i).substr(0,c.length+1)===c+":"&&(null!==b&&window.localStorage.key(i)!==c+":"+b||d.push(window.localStorage.key(i)));if(0===d.length)return void(a.fn.cacheImages.defaults.debug&&console.log("No Images to Drop"));for(i=0;i<d.length;i++)a.fn.cacheImages.defaults.debug&&console.log("Dropping localStorage Key:",d[i]),window.localStorage.removeItem(d[i]);a.fn.cacheImages.defaults.debug&&console.log("Dropped "+d.length+" images from storage")}}(jQuery);